* test idempotency more
* refactor away copy/paste of upgrade
